<?xml version="1.0" encoding="UTF-8"?>

<!--
Configuration for having Console error en development profile and
Sentry logs with "Sentry.xxxxxx" and save log.xxx in a file
for Production profile.
-->

<configuration>

    <!-- Default config and other properties -->
    <include resource="org/springframework/boot/logging/logback/defaults.xml"/>


    <!-- Development profile -->
    <springProfile name="development">
        <appender name="APPENDER" class="ch.qos.logback.core.ConsoleAppender">
            <layout class="ch.qos.logback.classic.PatternLayout">
                <Pattern>%(%d{ISO8601}) %highlight(%-5level) [%blue(%t)] %yellow(%C{1.}): %msg%n%throwable</Pattern>
            </layout>
        </appender>
        <logger name="org.springframework.security" level="DEBUG"/>
    </springProfile>

    <!-- Staging/production profile -->
    <springProfile name="!development">
        <!-- Configure the Sentry appender, overriding the logging threshold to the WARN level -->
        <appender name="APPENDER" class="io.sentry.logback.SentryAppender">
            <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
                <level>WARN</level>
            </filter>
            <!-- Optionally add an encoder -->
            <encoder>
                <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
            </encoder>
        </appender>

    </springProfile>

    <!-- Root logger -->
    <root level="INFO">
        <appender-ref ref="APPENDER"/>
    </root>
</configuration>